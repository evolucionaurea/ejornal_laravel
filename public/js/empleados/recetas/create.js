!function(e){var n={};function t(a){if(n[a])return n[a].exports;var i=n[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(a,i,function(n){return e[n]}.bind(null,i));return a},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="/",t(t.s=64)}({64:function(e,n,t){e.exports=t("tF4N")},tF4N:function(e,n){!function(e,n,t){"use strict";var a=!1;function i(){if(!a){a=!0;t.head.appendChild(Object.assign(t.createElement("style"),{textContent:"\n      .mm-back{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:9999}\n      .mm{background:#fff;border-radius:12px;box-shadow:0 15px 50px rgba(0,0,0,.25);max-width:640px;width:94%;padding:18px 20px}\n      .mm h3{margin:0 0 10px;font-size:18px;font-weight:800;color:#111}\n      .mm p{margin:0 0 10px;font-size:14px;color:#333}\n      .mm .row{display:flex;justify-content:flex-end;gap:8px;margin-top:14px}\n      .mm .btn{border:0;border-radius:8px;padding:9px 14px;font-size:14px;cursor:pointer}\n      .mm .b1{background:#2563eb;color:#fff}\n      .mm ul.mm-list{list-style:none;margin:6px 0 0;padding:0}\n      .mm ul.mm-list li{display:flex;align-items:flex-start;gap:10px; padding:8px 10px; border-radius:8px; background:#f8fafc; margin-bottom:8px; font-size:14px; color:#0f172a}\n      .mm ul.mm-list li .dot{width:8px;height:8px;border-radius:999px;background:#2563eb; margin-top:6px; flex:0 0 8px}\n      @media (prefers-color-scheme: dark){\n        .mm{background:#0f172a;color:#e2e8f0}\n        .mm h3{color:#e5e7eb}\n        .mm p{color:#cbd5e1}\n        .mm ul.mm-list li{background:#0b1221;color:#e2e8f0}\n        .mm ul.mm-list li .dot{background:#60a5fa}\n      }"}))}}function r(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=n.title,r=void 0===a?"Atención":a,o=n.html,l=void 0===o?"<p>Ocurrió un error.</p>":o;i();var c=e('<div class="mm-back" role="dialog" aria-modal="true"></div>'),d=e('<div class="mm"><h3>'.concat(r,"</h3>").concat(l,'<div class="row"><button class="btn b1">Aceptar</button></div></div>'));c.append(d).appendTo(t.body);var s=function(){return c.remove()};c.on("click",(function(e){e.target===c[0]&&s()})),d.find(".b1").on("click",s)}var o=function(e){return String(null!=e?e:"").replace(/[&<>"]/g,(function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[e]}))},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return'<ul class="mm-list">'.concat(e.map((function(e){return'<li><span class="dot"></span><div>'.concat(o(e),"</div></li>")})).join(""),"</ul>")},c=!1;function d(){return function(){if(!c){c=!0;t.head.appendChild(Object.assign(t.createElement("style"),{textContent:"@keyframes miniSpin{to{transform:rotate(360deg)}}.msw{display:inline-block;margin-left:6px;vertical-align:middle}.ms{width:16px;height:16px;animation:miniSpin .9s linear infinite}.ms circle{stroke-linecap:round}"}))}}(),'<span class="msw"><svg class="ms" viewBox="0 0 50 50"><defs><linearGradient id="g" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#2196f3"/><stop offset="100%" stop-color="#81d4fa"/></linearGradient></defs><circle cx="25" cy="25" r="20" stroke="url(#g)" fill="none" stroke-width="5"/></svg></span>'}function s(e,n){var t=e.closest(".form-group").find("label").first();t.length&&(n?!t.find(".msw").length&&t.append(d()):t.find(".msw").remove())}var m=!1;function p(){if(!m){m=!0;t.head.appendChild(Object.assign(t.createElement("style"),{textContent:"\n      .fl-back{\n        position:absolute; inset:0;\n        background: rgba(255,255,255,.75);\n        display:flex; align-items:center; justify-content:center;\n        z-index: 9998;\n        border-radius: 12px;\n      }\n      @media (prefers-color-scheme: dark){\n        .fl-back{ background: rgba(15,23,42,.72); }\n      }\n      .fl-box{\n        display:flex; align-items:center; gap:10px;\n        padding:10px 14px;\n        border-radius: 12px;\n        background: rgba(255,255,255,.95);\n        box-shadow: 0 10px 30px rgba(0,0,0,.18);\n        font-size: 14px;\n        color:#0f172a;\n      }\n      @media (prefers-color-scheme: dark){\n        .fl-box{ background: rgba(2,6,23,.92); color:#e2e8f0; }\n      }\n      .fl-spin{\n        width:18px; height:18px;\n        border-radius:999px;\n        border: 3px solid rgba(0,0,0,.12);\n        border-top-color: rgba(0,0,0,.55);\n        animation: flrot .9s linear infinite;\n      }\n      @media (prefers-color-scheme: dark){\n        .fl-spin{\n          border-color: rgba(255,255,255,.15);\n          border-top-color: rgba(255,255,255,.65);\n        }\n      }\n      @keyframes flrot{to{transform:rotate(360deg)}}\n    "}))}}function u(){var n=e("#recetaForm");if(n.length){var t=n.closest(".tarjeta");(t.length?t:n).find(".fl-back").remove()}}var f="",g={},v={},h=null,b="",x="";function y(e){try{return e?/^https?:\/\//i.test(e)?e:new URL(e,location.origin).toString():"/"}catch(n){return e}}function S(){var n=e("#recetaForm");return{financiadores:y(n.data("url-get-financiadores")),diagnosticos:y(n.data("url-get-diagnosticos")),medicamentos:y(n.data("url-get-medicamentos")),practicas:y(n.data("url-get-practicas")),provincias:y(n.data("url-get-provincias"))}}var w=function(e){if(!e)return"";var n=String(e).trim().match(/^(\d{4})-(\d{2})-(\d{2})/);return n?"".concat(n[3],"/").concat(n[2],"/").concat(n[1]):""},N=function(e){if(!e)return"";var n=/^(\d{1,2})[\/-](\d{1,2})[\/-](\d{4})$/.exec((e+"").trim());if(!n)return"";var t=("0"+n[1]).slice(-2),a=("0"+n[2]).slice(-2);return"".concat(n[3],"-").concat(a,"-").concat(t)};function k(e){var n=e.next(".select2").find(".select2-selection--single");n.css({height:"31px","min-height":"31px","border-radius":".2rem","border-color":"#ced4da",padding:"2px 8px"}),n.find(".select2-selection__rendered").css({"line-height":"26px","font-size":".875rem"}),n.find(".select2-selection__arrow").css({height:"29px",right:"6px"})}function F(n,a){var i=a.url,r=a.minLen,o=void 0===r?2:r,l=a.dataFn,c=a.procFn,d=a.tpl,m=a.langNoResults;n.select2({width:"100%",placeholder:"Buscar…",allowClear:!1,minimumInputLength:o,ajax:{delay:300,url:i,dataType:"json",cache:!0,data:function(e){return l?l(e):{q:e.term||"",page:e.page||1}},processResults:function(e){return c?c(e):e},beforeSend:function(){return s(n,!0)},complete:function(){return s(n,!1)},headers:{Accept:"application/json"},transport:function(n,t,a){var i=Object.assign({},n,{timeout:2e4});return e.ajax(i).done(t).fail(a)}},language:{noResults:function(){return m||"Sin resultados"}},dropdownParent:e(t.body),templateResult:d}),k(n)}function D(){return h?e.Deferred().resolve(h).promise():e.ajax({url:S().provincias,dataType:"json",headers:{Accept:"application/json"},timeout:2e4}).then((function(e){var n=Array.isArray(null==e?void 0:e.results)?e.results:[];return h=n,g={},v={},n.forEach((function(e){var n,t=null==e?void 0:e.id,a=String(null!==(n=null==e?void 0:e.nombre)&&void 0!==n?n:"").trim();null!=t&&a&&(g[String(t)]=a,v[a.toLowerCase()]=String(t))})),n})).catch((function(){return h=[],g={},v={},[]}))}function M(n,t){var a=t.visibleName,i=t.idName,r=e("#recetaForm");if(!r.length)return null;var o=r.find('[name="'.concat(a,'"]')),l=r.find('[name="'.concat(i,'"]')),c=o;if(o.length>1&&(o.slice(1).remove(),o=r.find('[name="'.concat(a,'"]')).first()),l.length>1&&(l.slice(1).remove(),l=r.find('[name="'.concat(i,'"]')).first()),o.length||(o=e('<input type="hidden" name="'.concat(a,'">')),r.append(o)),o.is("input")&&"hidden"!==(o.attr("type")||"text").toLowerCase()){var d=String(o.val()||"").trim();o.attr("type","hidden"),o.val(d),c=e('<input type="text" class="form-control form-control-sm" value="">'),o.after(c)}if(c&&c.length&&c.is("select"))return c.attr("name",i),c;l.length&&!c.length&&(c=l),c&&c.length||(c=e('<input type="text" class="form-control form-control-sm" value="">'),r.append(c)),l.length&&l[0]!==c[0]&&l.remove();var s=String(r.find('[name="'.concat(i,'"]')).val()||"").trim(),m=String(o.val()||"").trim(),p=function(n,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=a.name,r=String(n.val()||"").trim(),o=e('<select class="form-control form-control-sm"></select>');if(i&&o.attr("name",i),n.attr("id")&&o.attr("id",n.attr("id")),o.append(e("<option>").val("").text("Seleccione…")),t.forEach((function(n){var t,a=null!=(null==n?void 0:n.id)?String(n.id):"",i=String(null!==(t=null==n?void 0:n.nombre)&&void 0!==t?t:"").trim();o.append(e("<option>").val(a).text(i||a))})),n.replaceWith(o),r&&(o.val(r),!o.val())){var l=r.toLowerCase(),c=o.find("option").filter((function(){return String(e(this).text()||"").trim().toLowerCase()===l})).first();c.length&&o.val(c.val())}return o}(c,n,{name:i});if(s&&p.val(s),!p.val()&&m){var u=m.toLowerCase();v[u]&&p.val(v[u])}return p.on("change",(function(){var n=String(e(this).find("option:selected").text()||"").trim();o.val(n)})),p.trigger("change"),p}function j(e,n){if(e&&e.length){var t=e.closest(".form-group").find("label").first();e.prop("required",!!n),t.find(".req").remove(),n&&t.append(' <span class="req text-danger">*</span>')}}function C(){var n=e("#recetaForm"),t=function(e,t){var a=n.find('[name="'.concat(e,'"]'));a.length&&a.val(null!=t?t:"").trigger("input").trigger("change")};t("paciente[nombre]",""),t("paciente[apellido]",""),t("paciente[nroDoc]",""),t("paciente[email]",""),t("paciente[telefono]",""),t("paciente[fechaNacimiento]","");var a=e("#paciente_fecha_visual");a.length&&a.val("")}function _(n){if(!(n&&(String(n.nombre||"").trim()||String(n.apellido||"").trim()||String(n.dni||"").trim()||String(n.email||"").trim()||String(n.telefono||"").trim()||String(n.fechaNacimiento||"").trim())))C();else{var t=e("#recetaForm"),a=function(e,n){var a=t.find('[name="'.concat(e,'"]'));a.length&&a.val(null!=n?n:"").trigger("input").trigger("change")};a("paciente[nombre]",n.nombre),a("paciente[apellido]",n.apellido),a("paciente[nroDoc]",n.dni&&String(n.dni)),a("paciente[email]",n.email),a("paciente[telefono]",n.telefono);var i=function(e){if(!e)return"";var n=String(e).trim().match(/^(\d{4}-\d{2}-\d{2})/);return n?n[1]:""}(n.fechaNacimiento)||N(n.fechaNacimiento);a("paciente[fechaNacimiento]",i);var r=e("#paciente_fecha_visual");r.length?r.val(w(i)):f=i}}function O(){var n=e("#recetaForm"),t=function(e,t){var a=n.find('[name="'.concat(e,'"]'));a.length&&a.val(null!=t?t:"").trigger("input").trigger("change")};t("domicilio[calle]",""),t("domicilio[numero]",""),t("domicilio[provincia]","");var a=n.find('[name="domicilio[id_provincia]"]');a.length&&a.val("").trigger("change"),b="",x=""}function A(){var n=e("#id_nomina");if(n.length){var a=String(n.data("preset")||"").trim();a&&function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Cargando datos del trabajador…";p();var t=e("#recetaForm");if(t.length){var a=t.closest(".tarjeta"),i=a.length?a:t;if(!i.find(".fl-back").length){"static"===i.css("position")&&i.css("position","relative");var r=e('\n      <div class="fl-back" aria-live="polite" aria-busy="true">\n        <div class="fl-box">\n          <div class="fl-spin"></div>\n          <div class="fl-msg">'.concat(n,"</div>\n        </div>\n      </div>\n    "));i.append(r)}}}("Cargando datos del trabajador…");var i=n.find("option").toArray();if(i.length>1){var r=i.shift();i.sort((function(n,t){return e(n).text().localeCompare(e(t).text(),"es",{sensitivity:"base"})})),n.empty().append(r,i)}n.select2({width:"100%",minimumInputLength:0,dropdownParent:e(t.body)}),k(n),a&&(n.prop("disabled",!0).trigger("change.select2"),n.on("select2:opening select2:unselecting",(function(e){return e.preventDefault()})));var o=function(){var t,a,i;if(!n.val())return C(),O(),void u();var r=n.find("option:selected"),o=function(e){if(!(e=(e||"").trim().replace(/\s+/g," ")))return{apellido:"",nombre:""};if(e.includes(",")){var n=e.split(",");return{apellido:n[0].trim(),nombre:(n[1]||"").trim()}}var t=e.indexOf(" ");return-1===t?{apellido:"",nombre:e}:{apellido:e.slice(0,t),nombre:e.slice(t+1)}}((r.attr("data-nombre")||(null!==(t=r.data("nombre"))&&void 0!==t?t:"")||r.text()||"").replace(/\s+—\s+.*$/,"").replace(/\(DNI:.*?\)/,"").trim()),l=o.apellido,c=o.nombre,d=(r.attr("data-fecha-nacimiento")||"").trim()||String(null!==(a=r.data("fechaNacimiento"))&&void 0!==a?a:"").trim()||String(null!==(i=r.data("fecha-nacimiento"))&&void 0!==i?i:"").trim();_({nombre:c,apellido:l,dni:r.attr("data-dni")||r.data("dni"),email:r.attr("data-email")||r.data("email"),telefono:r.attr("data-telefono")||r.data("telefono"),fechaNacimiento:d}),function(n){var t=e("#recetaForm"),a=function(e,n){var a=t.find('[name="'.concat(e,'"]'));a.length&&a.val(null!=n?n:"").trigger("input").trigger("change")};if(!n||!String(n.calle||"").trim()&&!String(n.nro||"").trim()&&!String(n.id_provincia||"").trim()&&!String(n.provincia||"").trim())O();else{a("domicilio[calle]",n.calle),a("domicilio[numero]",null!=n.nro?String(n.nro).trim():"");var i=String(n.id_provincia||"").trim(),r=String(n.provincia||"").trim()||(i&&g[i]?g[i]:""),o=t.find('[name="domicilio[provincia]"]');o.length||(o=e('<input type="hidden" name="domicilio[provincia]">'),t.append(o)),o.val(r);var l=t.find('[name="domicilio[id_provincia]"]');if(l.length&&l.is("select")){if(i)l.val(i),l.val()||l.append(new Option(r||i,i,!0,!0));else if(r){var c=r.toLowerCase();v[c]&&l.val(v[c])}l.trigger("change")}else{b=i,x=r;var d=t.find('[name="domicilio[provincia]"]');d.length&&!d.is("select")&&d.val(r).trigger("input").trigger("change")}}}({calle:String(r.attr("data-cliente-calle")||"").trim(),nro:String(r.attr("data-cliente-nro")||r.attr("data-cliente-numero")||"").trim(),id_provincia:String(r.attr("data-cliente-id-provincia")||"").trim(),provincia:String(r.attr("data-cliente-provincia")||"").trim()}),setTimeout(u,50)};if(n.on("change select2:select",o),a&&n.find('option[value="'.concat(a,'"]')).length)return n.val(a).trigger("change"),void n.trigger("change.select2");n.val()?o():u()}}function L(){var n=e("#financiador"),a=e("#plan");if(n.length){var i;i=e("#recetaForm"),["cobertura[idFinanciador]","cobertura[planId]","cobertura[plan]"].forEach((function(e){i.find('input[name="'.concat(e,'"]')).length||i.append('<input type="hidden" name="'.concat(e,'">'))}));var r=S();a.select2({width:"100%",minimumInputLength:0,dropdownParent:e(t.body)}),k(a),a.prop("disabled",!0).trigger("change"),F(n,{url:r.financiadores,minLen:3,dataFn:function(e){return{q:e.term||""}},procFn:function(e){return{results:e.results||[]}}}),n.on("select2:select",(function(){var i,r,l,c,d=n.select2("data")[0],s=(null==d?void 0:d.raw)||{},m=null!==(i=null!==(r=null!==(l=null!==(c=s.idfinanciador)&&void 0!==c?c:s.nrofinanciador)&&void 0!==l?l:s.nroFinanciador)&&void 0!==r?r:s.id)&&void 0!==i?i:"";e('[name="cobertura[idFinanciador]"]').val(String(m).replace(/\D+/g,"")),function(n){try{a.select2("destroy")}catch(e){}a.empty();var i=(Array.isArray(n)?n:[]).reduce((function(e,n){var t,a,i,r,o=null!==(t=null!==(a=n.id)&&void 0!==a?a:n.planId)&&void 0!==t?t:n.planid,l=null!==(i=null!==(r=n.nombre)&&void 0!==r?r:n.descripcion)&&void 0!==i?i:n.name;return o&&l&&e.push({id:o,text:l}),e}),[]);i.forEach((function(e){return a.append(new Option(e.text,e.id))})),a.prop("disabled",0===i.length),a.select2({width:"100%",minimumInputLength:0,dropdownParent:e(t.body)}),k(a),i.length?a.val(String(i[0].id)).trigger("change"):(e('[name="cobertura[planId]"]').val(""),e('[name="cobertura[plan]"]').val(""))}(s.planes||[]),o()})),a.on("select2:select",(function(){var n=a.find("option:selected"),t=String(n.val()||"").replace(/\D+/g,"");e('[name="cobertura[planId]"]').val(t),e('[name="cobertura[plan]"]').val(n.text()||""),o()}))}function o(){var n=e("#medsWrapper");n.find(".sel-medicamento").each((function(){e(this).val(null).trigger("change")})),n.find('.regno,.presentacion,.nombre,.droga,input[name*="[tratamiento]"],input[name*="[posologia]"],textarea[name*="[indicaciones]"]').val(""),n.find(".duplicado").prop("checked",!1)}}function P(){var n=e('[name="cobertura[idFinanciador]"]').val()||e("#financiador").val(),t=e('[name="cobertura[planId]"]').val()||e("#plan").val(),a=e('[name="paciente[nroDoc]"]').val(),i=e('[name="cobertura[credencial]"]').val(),r={};return n&&(r.idFinanciador=n),t&&(r.planid=t),a&&(r.afiliadoDni=a),i&&(r.afiliadoCredencial=i),r}function R(n){var t=n.find(".sel-medicamento"),a=n.find(".regno"),i=n.find(".presentacion"),r=n.find(".nombre"),o=n.find(".droga"),l=n.find(".duplicado");a.attr("readonly","readonly"),n.find(".regno-help").length||a.after('<small class="text-muted regno-help">Se completa automáticamente al elegir un medicamento</small>');var c=n.find(".med-hint");function d(){var e=P();e.idFinanciador&&e.planid?c.text("Resultados filtrados por tu cobertura/plan."):c.text("Resultados generales (sin cobertura). Podés recetar con Reg. Nº + Cantidad.")}c.length||(c=e('<div class="med-hint small mt-1 text-muted"></div>'),t.closest(".form-group").append(c)),n.data("updateHint",d),d(),F(t,{url:S().medicamentos,minLen:2,dataFn:function(e){var n=P(),t={q:e.term||"",page:e.page||1};return n.idFinanciador&&(t.idFinanciador=n.idFinanciador),n.planid&&(t.planid=n.planid),n.afiliadoDni&&(t.afiliadoDni=n.afiliadoDni),n.afiliadoCredencial&&(t.afiliadoCredencial=n.afiliadoCredencial),t},procFn:function(e){var n;return{results:e.results||[],pagination:{more:!(null==e||null===(n=e.pagination)||void 0===n||!n.more)}}},tpl:function(n){if(!n.id)return n.text;var t=n.raw||{},a=[];return t.tieneCobertura&&a.push("Cobertura"),t.psicofarmaco&&a.push("Psicofármaco"),t.estupefaciente&&a.push("Estupefaciente"),t.ventaControlada&&a.push("Venta controlada"),t.hiv&&a.push("HIV"),e("<span>"+n.text+(a.length?' <small class="text-muted">('+a.join(", ")+")</small>":"")+"</span>")},langNoResults:"No hay medicamentos disponibles con ese criterio."}),t.on("select2:select",(function(){var e,n=(null===(e=t.select2("data")[0])||void 0===e?void 0:e.raw)||{};a.val(n.regNo||""),i.val(n.presentacion||""),r.val(n.nombreProducto||""),o.val(n.nombreDroga||""),!0===n.requiereDuplicado&&l.prop("checked",!0)}))}function T(){var n=1,a=e("#medsWrapper"),i=e("#btnAddMed");if(a.length){e(t).off("change.medFilter"),e(t).on("change.medFilter","#financiador, #plan",(function(){e("#medsWrapper .med-row").each((function(){var n=e(this),t=n.find(".sel-medicamento"),a=n.find(".regno"),i=n.find(".presentacion"),r=n.find(".nombre"),o=n.find(".droga"),l=n.find(".duplicado");t.length&&t.val(null).trigger("change"),a.val(""),i.val(""),r.val(""),o.val(""),l.prop("checked",!1);var c=n.data("updateHint");"function"==typeof c&&c()}))}));i.on("click",(function(){var t,i=e('\n      <div class="med-row border rounded p-2 mb-3">\n        <div class="form-row">\n          <div class="form-group col-md-4 mb-2">\n            <label class="mb-1 text-muted small">Buscar medicamento <span class="req text-danger">*</span></label>\n            <select class="form-control form-control-sm sel-medicamento" style="width:100%"></select>\n          </div>\n          <div class="form-group col-md-2 mb-2">\n            <label class="mb-1 text-muted small">Cantidad <span class="req text-danger">*</span></label>\n            <input type="number" min="1" class="form-control form-control-sm" name="medicamentos['.concat(t=n,'][cantidad]" required>\n          </div>\n          <div class="form-group col-md-3 mb-2">\n            <label class="mb-1 text-muted small">Registro Nº</label>\n            <input type="text" class="form-control form-control-sm regno" name="medicamentos[').concat(t,'][regNo]" readonly>\n          </div>\n          <div class="form-group col-md-3 mb-2">\n            <label class="mb-1 text-muted small">Presentación</label>\n            <input type="text" class="form-control form-control-sm presentacion" name="medicamentos[').concat(t,'][presentacion]">\n          </div>\n        </div>\n        <div class="form-row">\n          <div class="form-group col-md-4 mb-2">\n            <label class="mb-1 text-muted small">Nombre</label>\n            <input type="text" class="form-control form-control-sm nombre" name="medicamentos[').concat(t,'][nombre]">\n          </div>\n          <div class="form-group col-md-4 mb-2">\n            <label class="mb-1 text-muted small">Droga</label>\n            <input type="text" class="form-control form-control-sm droga" name="medicamentos[').concat(t,'][nombreDroga]">\n          </div>\n          <div class="form-group col-md-3 mb-2">\n            <label class="mb-1 text-muted small">Tratamiento (días)</label>\n            <input type="number" min="0" class="form-control form-control-sm" name="medicamentos[').concat(t,'][tratamiento]" placeholder="0">\n          </div>\n          <div class="form-group col-md-1 d-flex align-items-end mb-2">\n            <button type="button" class="btn btn-sm btn-outline-danger btn-del-med" title="Eliminar">×</button>\n          </div>\n        </div>\n        <div class="form-group mb-2">\n          <label class="mb-1 text-muted small">Posología</label>\n          <input type="text" class="form-control form-control-sm" name="medicamentos[').concat(t,'][posologia]">\n        </div>\n        <div class="form-group mb-2">\n          <label class="mb-1 text-muted small">Indicaciones / Observaciones</label>\n          <textarea class="form-control form-control-sm" name="medicamentos[').concat(t,'][indicaciones]" rows="2"></textarea>\n        </div>\n        <div class="custom-control custom-checkbox custom-control-inline">\n          <input type="checkbox" class="custom-control-input duplicado" id="dup').concat(t,'" name="medicamentos[').concat(t,'][forzarDuplicado]" value="1">\n          <label class="custom-control-label" for="dup').concat(t,'">Requiere duplicado</label>\n        </div>\n      </div>'));a.append(i),R(i),n++,r()})),a.on("click",".btn-del-med",(function(){a.children().length>1&&(e(this).closest(".med-row").remove(),r())})),R(a.find(".med-row").first()),r()}function r(){var e=a.children(".med-row");e.find(".btn-del-med").prop("disabled",e.length<=1)}}function I(){var n=e("#practica_search");if(n.length){F(n,{url:S().practicas,minLen:3,dataFn:function(e){var n=e.term||"",t={page:e.page||1},a=n.match(/tipo:([^ ]+)/i),i=n.match(/cat:([^ ]+)/i);a&&(t.tipo=a[1]),i&&(t.categoria=i[1]);var r=n.replace(/tipo:[^ ]+/gi,"").replace(/cat:[^ ]+/gi,"").trim();return r&&(t.search=r),t},procFn:function(e){var n;return{results:e.results||[],pagination:{more:!(null==e||null===(n=e.pagination)||void 0===n||!n.more)}}}});var t=e("#practicasList"),a=e("#practicasHidden");n.on("select2:select",(function(){var i=n.select2("data")[0];i&&(!function(n){var i=n.id;a.find('input[value="'.concat(i,'"]')).length||(a.append(e('<input type="hidden" name="practicas[]">').val(i)),t.append(e('<span class="badge badge-primary d-inline-flex align-items-center mr-2 mb-2" data-id="'.concat(i,'" style="font-size:.8rem;">\n          <span class="mr-2">').concat(o(n.text),'</span>\n          <button type="button" class="btn btn-sm btn-light py-0 px-1 quitar-chip" aria-label="Quitar" style="line-height:1;">×</button>\n        </span>'))))}(i),n.val(null).trigger("change"))})),t.on("click",".quitar-chip",(function(){var n=e(this).closest("[data-id]").data("id");a.find('input[name="practicas[]"][value="'.concat(n,'"]')).remove(),e(this).closest("[data-id]").remove()}))}}function E(){var n=e('[name="medico[matricula][tipo]"]'),t=e('[name="medico[matricula][numero]"]');D().then((function(a){M(a,{visibleName:"domicilio[provincia]",idName:"domicilio[id_provincia]"});var i=e('[name="domicilio[id_provincia]"]');i.length&&b&&(i.val(b),i.val()||i.append(new Option(x||b,b,!0,!0)),i.trigger("change"),b="",x="");var r=M(a,{visibleName:"medico[matricula][provincia]",idName:"medico[matricula][id_provincia]"}),o=r?r.closest(".form-group"):null;function l(){var e=String(n.val()||"MN").toUpperCase().trim();n.val()||n.val("MN"),t.attr("maxlength","10"),j(t,!0),"MP"===e?(o&&o.length&&o.show(),r&&r.length&&j(r,!0)):(o&&o.length&&o.hide(),r&&r.length&&j(r,!1))}n.on("change",l),n.val()||n.val("MN"),l()}))}function q(){var n=e("#recetaForm");n.length&&n.on("submit",(function(t){t.preventDefault();var a=[];!function(){var n=e("#recetaForm");if(n.length){var t=n.find('[name="domicilio[id_provincia]"]'),a=n.find('[name="domicilio[provincia]"]');if(a.length||(a=e('<input type="hidden" name="domicilio[provincia]">'),n.append(a)),t.length){var i=String(t.find("option:selected").text()||"").trim();i&&"Seleccione…"!==i&&a.val(i)}var r=n.find('[name="medico[matricula][id_provincia]"]'),o=n.find('[name="medico[matricula][provincia]"]');if(o.length||(o=e('<input type="hidden" name="medico[matricula][provincia]">'),n.append(o)),r.length){var l=String(r.find("option:selected").text()||"").trim();l&&"Seleccione…"!==l&&o.val(l)}}}();var i=e("#paciente_fecha_visual").val(),c=N(i);i&&c&&e('[name="paciente[fechaNacimiento]"]').val(c);var d=(e('[name="paciente[nroDoc]"]').val()||"").replace(/\D+/g,"");d?(d.length<7||d.length>9)&&a.push("DNI del paciente debe tener entre 7 y 9 dígitos."):a.push("DNI del paciente es obligatorio.");var s=String(e('[name="paciente[sexo]"]').val()||"").toUpperCase();["M","F","X","O"].includes(s)||a.push("Sexo seleccionado no es válido.");var m=e('[name="paciente[fechaNacimiento]"]').val();if(m){var p=new Date(m+"T00:00:00"),u=new Date;u.setHours(0,0,0,0),isNaN(p.getTime())?a.push("Fecha de nacimiento inválida."):p>u&&a.push("La fecha de nacimiento no puede ser futura.")}else a.push("Fecha de nacimiento es obligatoria.");var f=String(e('[name="medico[matricula][tipo]"]').val()||"MN").toUpperCase(),g=String(e('[name="medico[matricula][numero]"]').val()||"").replace(/\D+/g,""),v=String(e('[name="medico[matricula][provincia]"]').val()||"").trim(),h=String(e('[name="medico[matricula][id_provincia]"]').val()||"").trim();g?g.length>10&&a.push("Número de matrícula: máximo 10 dígitos."):a.push("Número de matrícula es obligatorio."),"MP"!==f||v||h||a.push("Para matrícula provincial (MP), la provincia es obligatoria.");var b=String(e('[name="domicilio[calle]"]').val()||"").trim(),x=String(e('[name="domicilio[numero]"]').val()||"").trim(),y=String(e('[name="domicilio[provincia]"]').val()||"").trim(),S=String(e('[name="domicilio[id_provincia]"]').val()||"").trim();b||a.push("Domicilio: la calle es obligatoria."),x||a.push("Domicilio: el número es obligatorio."),y||S||a.push("Domicilio: la provincia es obligatoria.");var w=String(e('[name="cobertura[idFinanciador]"]').val()||"").trim(),k=String(e('[name="cobertura[credencial]"]').val()||"").trim();w&&(k?/^\d+$/.test(k)||a.push("Cobertura: el número de afiliado debe tener solo números (sin puntos ni guiones)."):a.push("Cobertura: el número de afiliado es obligatorio si indicás un financiador."));var F=e("#medsWrapper .med-row");if(F.length||a.push("Agregá al menos un medicamento."),F.each((function(n){var t=e(this),i=Number(t.find('input[name^="medicamentos"][name$="[cantidad]"]').val()||0),r=String(t.find(".regno").val()||"").trim(),o=String(t.find(".presentacion").val()||"").trim(),l=String(t.find(".nombre").val()||"").trim(),c=String(t.find(".droga").val()||"").trim(),d=String(t.find('input[name^="medicamentos"][name$="[tratamiento]"]').val()||"").trim();(!i||i<1)&&a.push("Medicamento (fila ".concat(n+1,"): la cantidad debe ser mayor a 0.")),r||a.push("Medicamento (fila ".concat(n+1,"): seleccioná un medicamento de la lista (Registro Nº).")),r&&(o||a.push("Medicamento (fila ".concat(n+1,"): la presentación es obligatoria.")),l||a.push("Medicamento (fila ".concat(n+1,"): el nombre es obligatorio.")),c||a.push("Medicamento (fila ".concat(n+1,"): la droga es obligatoria.")),""!==d&&isNaN(Number(d))&&a.push("Medicamento (fila ".concat(n+1,"): tratamiento inválido.")))})),a.length)r({title:"Revisá estos datos",html:l(a)});else{var D=n.attr("action"),M=n.serialize(),j=n.find('button[type="submit"]'),C=j.html();j.prop("disabled",!0).html("Generando…"),e.ajax({type:"POST",url:D,data:M,headers:{Accept:"application/json"},timeout:2e4}).done((function(e){if(e&&e.ok)return e.url?void location.assign(new URL(e.url,location.origin).toString()):e.show?void location.assign(new URL(e.show,location.origin).toString()):void location.assign(location.origin+"/empleados/recetas");r({title:"Aviso",html:"<p>".concat(o((null==e?void 0:e.message)||"Operación realizada."),"</p>")})})).fail((function(e){var n=[];if(422===e.status){var t=(e.responseJSON||{}).errors||{};n=Object.keys(t).map((function(e){return"".concat(e,": ").concat((t[e]||[]).join(" "))}))}else if(504===e.status)n=["El servicio tardó demasiado en responder. Probá nuevamente."];else try{var a=e.responseJSON||JSON.parse(e.responseText||"{}"),i=a.message||a.mensaje||e.statusText||"Error al generar la receta.";i&&n.push(i),a.code&&n.push("Código técnico: "+a.code)}catch(e){n.push("Error desconocido al generar la receta.")}r({title:"No se pudo generar la receta",html:l(n)})})).always((function(){j.prop("disabled",!1).html(C)}))}}))}e((function(){var n;e.ajaxSetup({headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")},timeout:2e4}),(n=e('[name="paciente[sexo]"]')).length&&(n.val()||n.val("M"),n.find("option").each((function(){var n=e(this).val();"M"===n?e(this).text("Hombre (M)"):"F"===n?e(this).text("Mujer (F)"):"X"===n?e(this).text("No binario (X)"):"O"===n&&e(this).text("Otro (O)")}))),function(){var n=e('[name="paciente[fechaNacimiento]"]');if(n.length){var t=e('<input type="text" id="paciente_fecha_visual" class="form-control form-control-sm" placeholder="DD/MM/AAAA" readonly>'),a=n.val();t.val(w(a)).insertAfter(n),f&&(n.val(f),t.val(w(f)),f=""),n.attr("type","hidden"),t.on("keydown paste",(function(e){return e.preventDefault()})),e.datepicker&&!e.datepicker.regional.es&&(e.datepicker.regional.es={closeText:"Cerrar",prevText:"Anterior",nextText:"Siguiente",currentText:"Hoy",monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthNamesShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],dayNames:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dayNamesShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],dayNamesMin:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],weekHeader:"Sm",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.setDefaults(e.datepicker.regional.es)),e.fn.datepicker&&t.datepicker({changeMonth:!0,changeYear:!0,yearRange:"1900:+0",dateFormat:"dd/mm/yy",onClose:function(e){return n.val(N(e))}}),t.on("focus click",(function(){e.fn.datepicker&&e(this).datepicker("show")}))}}(),q();var t=0,a=setInterval((function(){t++,"function"==typeof e.fn.select2?(clearInterval(a),D().then((function(n){E(),A(),L(),function(){var n=e("#diag_search");n.length&&(F(n,{url:S().diagnosticos,minLen:3,procFn:function(e){return e}}),n.on("select2:select",(function(){var t=n.select2("data")[0];e("#diagnostico_codigo").val((null==t?void 0:t.id)||""),e("#diagnostico").val((null==t?void 0:t.text)||"")})))}(),T(),I()}))):t>60&&(clearInterval(a),D().then((function(){E()})),T())}),100)}))}(jQuery,window,document)}});